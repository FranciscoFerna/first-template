---
const {
  title = "Contacto",
  subtitle = "Completa el formulario y te responderemos lo antes posible.",
} = Astro.props;
---

<section id="contacto" class="py-20 bg-background" aria-labelledby="contact-title">
  <div class="max-w-3xl mx-auto px-4">
    <header class="text-center mb-12">
      <h2 id="contact-title" class="text-3xl sm:text-4xl font-bold mb-4 text-foreground">
        {title}
      </h2>
      <p class="text-muted-foreground text-lg">{subtitle}</p>
    </header>

    <form id="contact-form" class="space-y-6" method="POST" action="/api/contact" novalidate>
      <div>
        <label for="name" class="block mb-2 font-medium text-foreground">
          Nombre <span class="text-destructive">*</span>
        </label>
        <input
          type="text"
          id="name"
          name="name"
          required
          class="w-full border border-input bg-background rounded-lg p-4 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
          placeholder="Tu nombre completo"
        />
      </div>

      <div>
        <label for="email" class="block mb-2 font-medium text-foreground">
          Email <span class="text-destructive">*</span>
        </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          class="w-full border border-input bg-background rounded-lg p-4 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
          placeholder="tu@email.com"
        />
      </div>

      <div>
        <label for="message" class="block mb-2 font-medium text-foreground">
          Mensaje <span class="text-destructive">*</span>
        </label>
        <textarea
          id="message"
          name="message"
          rows="5"
          required
          class="w-full border border-input bg-background rounded-lg p-4 text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all resize-none"
          placeholder="¿En qué podemos ayudarte?"
        ></textarea>
      </div>

      <button
        type="submit"
        class="w-full bg-primary text-primary-foreground px-8 py-4 rounded-lg font-bold hover:bg-primary/90 transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 flex items-center justify-center gap-2"
      >
        Enviar mensaje
      </button>

      <div id="form-messages" class="mt-4 hidden p-4 rounded-lg"></div>
    </form>
  </div>

  <script type="module">
    const form = document.getElementById('contact-form');
    const messages = document.getElementById('form-messages');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messages.classList.add('hidden');
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch(form.action, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        if (!res.ok) throw new Error('Error al enviar el formulario');
        messages.className = 'bg-green-50 border border-green-200 rounded-xl p-6 text-center';
        messages.innerHTML = '<strong>¡Mensaje enviado!</strong><p>Gracias por contactarnos. Te responderemos pronto.</p>';
        messages.classList.remove('hidden');
        form.reset();
      } catch (error) {
        messages.className = 'bg-red-50 border border-red-200 rounded-xl p-6 text-center';
        messages.innerHTML = '<strong>Error:</strong> Hubo un problema al enviar el mensaje.';
        messages.classList.remove('hidden');
      }
    });
  </script>
</section>
